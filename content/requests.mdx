# Requests

## `zwylib.Requests`

```python
class Requests
```

A utility class providing static methods for interacting with Telegram's API, including fetching message history, searching messages, managing chat settings, and more.

### Static Methods

#### `get_history`

```python
Requests.get_history(
    peer_id: int,
    callback: (List[TLRPC.TL_message] | None, TLRPC.TL_error | None) -> None = None,
    limit: int = 100,
    offset_id: int = 0,
    offset_date: int = 0,
    add_offset: int = 0,
    max_message_id: int = 0,
    min_message_id: int = 0,
    request_delay: int = 0
) -> None
```

Asynchronously fetches the message history for a given peer (chat or user) and passes the result to the provided callback. ([TL schema](https://core.telegram.org/method/messages.getHistory))

**Arguments**

- `peer_id` (`int`): ID of the peer (chat or user) to fetch history from.
- `callback` (`(List[TLRPC.TL_message] | None, TLRPC.TL_error | None) -> None`, default `None`): Function called with the list of messages (or `None`) and an error (or `None`).
- `limit` (`int`, default `100`): Maximum number of messages to retrieve.
- `offset_id` (`int`, default `0`): Message ID to start fetching from.
- `offset_date` (`int`, default `0`): Date offset for fetching messages.
- `add_offset` (`int`, default `0`): Additional offset for pagination.
- `max_message_id` (`int`, default `0`): Maximum message ID to include.
- `min_message_id` (`int`, default `0`): Minimum message ID to include.
- `request_delay` (`int`, default `0`): Delay in seconds before sending the request.

**Example**

```python
def history_callback(messages, error):
    if error:
        print(f"Error: {error}")
    else:
        print(f"Received {len(messages)} messages")

zwylib.Requests.get_history(peer_id=-12345, callback=history_callback, limit=50)
```

---

#### `search_messages`

```python
Requests.search_messages(
    peer_id: int,
    from_peer_id: Optional[int] = None,
    saved_peer_id: Optional[int] = None,
    reaction: Optional[TLRPC.Reaction] = None,
    callback: (List[TLRPC.TL_message] | None, TLRPC.TL_error | None) -> None = None,
    query: Optional[str] = None,
    search_filter = TLRPC.TL_inputMessagesFilterEmpty(),
    topic_id: Optional[int] = None,
    limit: int = 100,
    offset_id: int = 0,
    add_offset: int = 0,
    max_message_id: int = 0,
    min_message_id: int = 0,
    min_date: int = 0,
    max_date: int = 0,
    request_delay: int = 0
) -> None
```

Asynchronously searches for messages in a peer based on specified criteria and passes the result to the provided callback. ([TL schema](https://core.telegram.org/method/messages.search))

**Arguments**

- `peer_id` (`int`): ID of the peer to search in.
- `from_peer_id` (`Optional[int]`, default `None`): ID of the sender to filter messages by.
- `saved_peer_id` (`Optional[int]`, default `None`): ID of the saved messages peer.
- `reaction` (`Optional[TLRPC.Reaction]`, default `None`): Reaction to filter messages by.
- `callback` (`(List[TLRPC.TL_message] | None, TLRPC.TL_error | None) -> None`, default `None`): Function called with the list of messages (or `None`) and an error (or `None`).
- `query` (`Optional[str]`, default `None`): Search query string.
- `search_filter` (`TLRPC.TL_inputMessagesFilter`, default `TLRPC.TL_inputMessagesFilterEmpty`): Filter for message types.
- `topic_id` (`Optional[int]`, default `None`): ID of the topic to search within.
- `limit` (`int`, default `100`): Maximum number of messages to retrieve.
- `offset_id` (`int`, default `0`): Message ID to start searching from.
- `add_offset` (`int`, default `0`): Additional offset for pagination.
- `max_message_id` (`int`, default `0`): Maximum message ID to include.
- `min_message_id` (`int`, default `0`): Minimum message ID to include.
- `min_date` (`int`, default `0`): Minimum date for messages.
- `max_date` (`int`, default `0`): Maximum date for messages.
- `request_delay` (`int`, default `0`): Delay in seconds before sending the request.

**Example**

```python
def search_callback(messages, error):
    if error:
        print(f"Error: {error}")
    else:
        print(f"Found {len(messages)} messages")

zwylib.Requests.search_messages(peer_id=-12345, query="hello", callback=search_callback)
```

---

#### `reload_admins`

```python
Requests.reload_admins(chat_id: int) -> None
```

Reloads the list of administrators for a given chat.

**Arguments**

- `chat_id` (`int`): ID of the chat to reload administrators for.

**Example**

```python
zwylib.Requests.reload_admins(chat_id=-12345)
# Reloads admins for the specified chat
```

---

#### `delete_messages`

```python
Requests.delete_messages(messages: List[int], peer_id: int, topic_id: Optional[int]) -> None
```

Deletes a list of messages from a peer, optionally within a specific topic.

**Arguments**

- `messages` (`List[int]`): List of message IDs to delete.
- `peer_id` (`int`): ID of the peer (chat or user) containing the messages.
- `topic_id` (`Optional[int]`): ID of the topic, if applicable. If `None`, no topic is specified.

**Example**

```python
zwylib.Requests.delete_messages(messages=[67890, 67891], peer_id=-12345, topic_id=100)
# Deletes specified messages from the chat
```

---

#### `unban`

```python
Requests.unban(
    chat_id: int,
    target_id: int,
    callback: (TLRPC.Updates | None, TLRPC.TL_error | None) -> None = None,
    request_delay: int = 0
) -> None
```

Removes a ban from a user in a chat, effectively granting them default permissions.

**Arguments**

- `chat_id` (`int`): ID of the chat to unban the user from.
- `target_id` (`int`): ID of the user to unban.
- `callback` (`(TLRPC.Updates | None, TLRPC.TL_error | None) -> None`, default `None`): Function called with the update result (or `None`) and an error (or `None`).
- `request_delay` (`int`, default `0`): Delay in seconds before sending the request.

**Example**

```python
def unban_callback(updates, error):
    if error:
        print(f"Error: {error}")
    else:
        print("User unbanned")

zwylib.Requests.unban(chat_id=-12345, target_id=123456, callback=unban_callback)
```

---

#### `change_slowmode`

```python
Requests.change_slowmode(
    seconds: int,
    chat_id: int,
    callback: (TLRPC.Updates | None, TLRPC.TL_error | None) -> None = None,
    request_delay: int = 0
) -> None
```

Changes the slow mode duration for a chat.

**Arguments**

- `seconds` (`int`): Number of seconds for the slow mode delay (0 to disable).
- `chat_id` (`int`): ID of the chat to modify.
- `callback` (`(TLRPC.Updates | None, TLRPC.TL_error | None) -> None`, default `None`): Function called with the update result (or `None`) and an error (or `None`).
- `request_delay` (`int`, default `0`): Delay in seconds before sending the request.

**Example**

```python
def slowmode_callback(updates, error):
    if error:
        print(f"Error: {error}")
    else:
        print("Slow mode updated")

zwylib.Requests.change_slowmode(seconds=30, chat_id=-12345, callback=slowmode_callback)
```

---

#### `get_message`

```python
Requests.get_message(
    peer_id: int,
    message_id: int,
    callback: (TLRPC.TL_message | TLRPC.TL_messageEmpty) -> None = None,
    get_msg_tries_limit: int = 10,
    wait_time_seconds: int = 1
) -> None
```

Asynchronously reloads a specific message from the server and retrieves it from local storage, passing it to the callback. Retries up to `get_msg_tries_limit` times if the message is not yet available.

**Arguments**

- `peer_id` (`int`): ID of the peer (chat or user) containing the message.
- `message_id` (`int`): ID of the message to retrieve.
- `callback` (`(TLRPC.TL_message | TLRPC.TL_messageEmpty) -> None`, default `None`): Function called with the message (or `None`) when retrieved.
- `get_msg_tries_limit` (`int`, default `10`): Maximum number of retry attempts.
- `wait_time_seconds` (`int`, default `1`): Delay between retry attempts in seconds.

**Example**

```python
def message_callback(msg):
    if msg:
        print(f"Message: {msg.message}")
    else:
        print("Message not found")

zwylib.Requests.get_message(peer_id=-12345, message_id=67890, callback=message_callback)
```
